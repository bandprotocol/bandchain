const { expectRevert } = require("openzeppelin-test-helpers");
const Bridge = artifacts.require("BridgeMock");
const ReceiverMock = artifacts.require("ReceiverMock");

require("chai").should();

contract("Bridge", ([_, owner, alice, bob]) => {
  context("Checking oracle state relay (4 validators)", () => {
    beforeEach(async () => {
      this.bridge = await Bridge.new(
        [
          ["0x652D89a66Eb4eA55366c45b1f9ACfc8e2179E1c5", 100],
          ["0x88e1cd00710495EEB93D4f522d16bC8B87Cb00FE", 100],
          ["0xaAA22E077492CbaD414098EBD98AA8dc1C7AE8D9", 100],
          ["0xB956589b6fC5523eeD0d9eEcfF06262Ce84ff260", 100],
        ],
        { from: owner },
      );
    });

    it("should accept correct state relay (validator power is more than 2/3)", async () => {
      await this.bridge.relayOracleState(
        "191", // _blockHeight,
        [
          "0x685430546D23A44E6B8034EAAFBC2F4CD7FEF54B54D5B66528CB4E5225BD74FB", // accToGovStoresMerkleHash
          "0x4F8D0BB0CD3EB9DC70B4DBBEA5F0CBD5B523195F7BAE02BB401BB00A93ABA08E", // mainAndMintStoresMerkleHash
          "0x1912057FFF0B3E85ABF1A319F75D37B21B430F3DA7DB9E486A5041DE47C686D3", // oracleIAVLStateHash
          "0xB1F2FD852E790E735CA2D3014F96A2A53C60393E9C6BBF941B9A6DD6A05CF6F9", // paramsStoresMerkleHash
          "0x91CC906286235B676AD402FC04ED768EB2BFECA664E8D595C286571DA1433C60", // slashingToUpgradeStoresMerkleHash
        ],
        [
          "0x32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E", // versionAndChainIdHash
          "0xD9F175396C0E2D0E77F69856ABF5D8E69283CB915EB8886262FEDA1D519B3005", // timeHash
          "0x4F4D548668A3986DB253689234B9CAC96303A128B7081B16E53B79AB9E65B887", // lastBlockIDAndOther
          "0x004209A161040AB1778E2F2C00EE482F205B28EFBA439FCB04EA283F619478D9", // nextValidatorHashAndConsensusHash
          "0x6E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D", // lastResultsHash
          "0xD991DA4D4E69473CC75A4B819F9E07D4956671A6F4A74DF4CC16596FCBE68137", // evidenceAndProposerHash
        ],
        [
          [
            "0x9279257914BFEE6FAEC46DF086E9A673A4C1576FB299094D45F77E12FA3728E7", // r
            "0x04DBF23F5EBB07BA8FD7CA06843DFE363B5E86596930E1889D9BD5BD3E98FC53", // s
            28, // v
            "0x6E080211BF0000000000000022480A20", // _signedDataPrefix
            "0x12240A2066424E8F0417945A71067A55B7121282A90524E3C0709D8F8ADDB6ADC8FD46D110012A0C08E6E9C6F70510979FBD9801320962616E64636861696E", // signedDataSuffix
          ],
          [
            "0x826BB17B714EBCD8199EE2A01334102F19248087CFDEEE42EBD406B3991C3895", // r
            "0x621281EEDF97F3A9EC121224CEF9F8C07872D2C81CCE44DD846BB3678DD50523", // s
            27, // v
            "0x6E080211BF0000000000000022480A20", // _signedDataPrefix
            "0x12240A2066424E8F0417945A71067A55B7121282A90524E3C0709D8F8ADDB6ADC8FD46D110012A0C08E6E9C6F70510DD89E98A01320962616E64636861696E", // signedDataSuffix
          ],
          [
            "0xD775FD0E1580499EF16A4AB1998DCB4CBD47CF6F342CDC51A9552D1434552ED8", // r
            "0x5A1A2075AE97A6BBD07A5A40EFE287ECEAB37C7A7CAAE82E6C997C51C6233470", // s
            27, // v
            "0x6E080211BF0000000000000022480A20", // _signedDataPrefix
            "0x12240A2066424E8F0417945A71067A55B7121282A90524E3C0709D8F8ADDB6ADC8FD46D110012A0C08E6E9C6F70510AB94A59201320962616E64636861696E", // signedDataSuffix
          ],
        ],
      );
    });

    it("should revert if sum of validator powers is less than 2/3)", async () => {
      await expectRevert(
        this.bridge.relayOracleState(
          "191", // _blockHeight,
          [
            "0x685430546D23A44E6B8034EAAFBC2F4CD7FEF54B54D5B66528CB4E5225BD74FB", // accToGovStoresMerkleHash
            "0x4F8D0BB0CD3EB9DC70B4DBBEA5F0CBD5B523195F7BAE02BB401BB00A93ABA08E", // mainAndMintStoresMerkleHash
            "0x1912057FFF0B3E85ABF1A319F75D37B21B430F3DA7DB9E486A5041DE47C686D3", // oracleIAVLStateHash
            "0xB1F2FD852E790E735CA2D3014F96A2A53C60393E9C6BBF941B9A6DD6A05CF6F9", // paramsStoresMerkleHash
            "0x91CC906286235B676AD402FC04ED768EB2BFECA664E8D595C286571DA1433C60", // slashingToUpgradeStoresMerkleHash
          ],
          [
            "0x32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E", // versionAndChainIdHash
            "0xD9F175396C0E2D0E77F69856ABF5D8E69283CB915EB8886262FEDA1D519B3005", // timeHash
            "0x4F4D548668A3986DB253689234B9CAC96303A128B7081B16E53B79AB9E65B887", // lastBlockIDAndOther
            "0x004209A161040AB1778E2F2C00EE482F205B28EFBA439FCB04EA283F619478D9", // nextValidatorHashAndConsensusHash
            "0x6E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D", // lastResultsHash
            "0xD991DA4D4E69473CC75A4B819F9E07D4956671A6F4A74DF4CC16596FCBE68137", // evidenceAndProposerHash
          ],
          [
            [
              "0x9279257914BFEE6FAEC46DF086E9A673A4C1576FB299094D45F77E12FA3728E7", // r
              "0x04DBF23F5EBB07BA8FD7CA06843DFE363B5E86596930E1889D9BD5BD3E98FC53", // s
              28, // v
              "0x6E080211BF0000000000000022480A20", // _signedDataPrefix
              "0x12240A2066424E8F0417945A71067A55B7121282A90524E3C0709D8F8ADDB6ADC8FD46D110012A0C08E6E9C6F70510979FBD9801320962616E64636861696E", // signedDataSuffix
            ],
            [
              "0xD775FD0E1580499EF16A4AB1998DCB4CBD47CF6F342CDC51A9552D1434552ED8", // r
              "0x5A1A2075AE97A6BBD07A5A40EFE287ECEAB37C7A7CAAE82E6C997C51C6233470", // s
              27, // v
              "0x6E080211BF0000000000000022480A20", // _signedDataPrefix
              "0x12240A2066424E8F0417945A71067A55B7121282A90524E3C0709D8F8ADDB6ADC8FD46D110012A0C08E6E9C6F70510AB94A59201320962616E64636861696E", // signedDataSuffix
            ],
          ],
        ),
        "INSUFFICIENT_VALIDATOR_SIGNATURES",
      );
    });

    it("should not accept out-of-order signatures", async () => {
      await expectRevert(
        this.bridge.relayOracleState(
          "191", // _blockHeight,
          [
            "0x685430546D23A44E6B8034EAAFBC2F4CD7FEF54B54D5B66528CB4E5225BD74FB", // accToGovStoresMerkleHash
            "0x4F8D0BB0CD3EB9DC70B4DBBEA5F0CBD5B523195F7BAE02BB401BB00A93ABA08E", // mainAndMintStoresMerkleHash
            "0x1912057FFF0B3E85ABF1A319F75D37B21B430F3DA7DB9E486A5041DE47C686D3", // oracleIAVLStateHash
            "0xB1F2FD852E790E735CA2D3014F96A2A53C60393E9C6BBF941B9A6DD6A05CF6F9", // paramsStoresMerkleHash
            "0x91CC906286235B676AD402FC04ED768EB2BFECA664E8D595C286571DA1433C60", // slashingToUpgradeStoresMerkleHash
          ],
          [
            "0x32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E", // versionAndChainIdHash
            "0xD9F175396C0E2D0E77F69856ABF5D8E69283CB915EB8886262FEDA1D519B3005", // timeHash
            "0x4F4D548668A3986DB253689234B9CAC96303A128B7081B16E53B79AB9E65B887", // lastBlockIDAndOther
            "0x004209A161040AB1778E2F2C00EE482F205B28EFBA439FCB04EA283F619478D9", // nextValidatorHashAndConsensusHash
            "0x6E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D", // lastResultsHash
            "0xD991DA4D4E69473CC75A4B819F9E07D4956671A6F4A74DF4CC16596FCBE68137", // evidenceAndProposerHash
          ],
          [
            [
              "0x9279257914BFEE6FAEC46DF086E9A673A4C1576FB299094D45F77E12FA3728E7", // r
              "0x04DBF23F5EBB07BA8FD7CA06843DFE363B5E86596930E1889D9BD5BD3E98FC53", // s
              28, // v
              "0x6E080211BF0000000000000022480A20", // _signedDataPrefix
              "0x12240A2066424E8F0417945A71067A55B7121282A90524E3C0709D8F8ADDB6ADC8FD46D110012A0C08E6E9C6F70510979FBD9801320962616E64636861696E", // signedDataSuffix
            ],
            [
              "0xD775FD0E1580499EF16A4AB1998DCB4CBD47CF6F342CDC51A9552D1434552ED8", // r
              "0x5A1A2075AE97A6BBD07A5A40EFE287ECEAB37C7A7CAAE82E6C997C51C6233470", // s
              27, // v
              "0x6E080211BF0000000000000022480A20", // _signedDataPrefix
              "0x12240A2066424E8F0417945A71067A55B7121282A90524E3C0709D8F8ADDB6ADC8FD46D110012A0C08E6E9C6F70510AB94A59201320962616E64636861696E", // signedDataSuffix
            ],
            [
              "0x826BB17B714EBCD8199EE2A01334102F19248087CFDEEE42EBD406B3991C3895", // r
              "0x621281EEDF97F3A9EC121224CEF9F8C07872D2C81CCE44DD846BB3678DD50523", // s
              27, // v
              "0x6E080211BF0000000000000022480A20", // _signedDataPrefix
              "0x12240A2066424E8F0417945A71067A55B7121282A90524E3C0709D8F8ADDB6ADC8FD46D110012A0C08E6E9C6F70510DD89E98A01320962616E64636861696E", // signedDataSuffix
            ],
          ],
        ),
        "INVALID_SIGNATURE_SIGNER_ORDER",
      );
    });
  });

  context("Checking data verification", () => {
    beforeEach(async () => {
      this.bridge = await Bridge.new([]);
      await this.bridge.setOracleState(
        "182", // _blockHeight
        "0xB59AD73DB9147F6AC7C88A64B1BAD51C90F8C48B4487ADA9276A323808E56E3E", // _oracleIAVLStateHash
      );
    });

    it("should not accept unrelayed block", async () => {
      await expectRevert(
        this.bridge.verifyOracleData(
          "9999", // _blockHeight
          ["beeb", 1, "0x0000000342544300000000000003e8", 4, 4], // _requestPacket
          ["beeb", 1, 4, 1591598291, 1591598295, 1, "0x0000000000948e69"], // _responsePacket
          "163", // _version
          [
            [
              true, // isDataOnRight
              "2", // subtreeHeight
              "3", // subtreeSize
              "180", // subtreeVersion
              "0x4D4479F8CF02CBA65F95231B06EEAA51E99F75A153C3ED28D9A86B565DE59306", // siblingHash
            ],
            [
              true, // isDataOnRight
              "3", // subtreeHeight
              "5", // subtreeSize
              "180", // subtreeVersion
              "0x8861AD25F99A677D4934541A99928CDBE18BBF34EE39D754E93CCE090BE70502", // siblingHash
            ],
            [
              true, // isDataOnRight
              "4", // subtreeHeight
              "9", // subtreeSize
              "180", // subtreeVersion
              "0x5D162C955AE030390CEA63CA7ED8BA72B7A49E0BC73DAEA23CF6B79E8899C49C", // siblingHash
            ],
            [
              true, // isDataOnRight
              "5", // subtreeHeight
              "16", // subtreeSize
              "180", // subtreeVersion
              "0x08DD24B96C3C9413BA46A7149232C18AD66DB68AC04CF2A770B707B6D29FC8F7", // siblingHash
            ],
            [
              true, // isDataOnRight
              "6", // subtreeHeight
              "24", // subtreeSize
              "180", // subtreeVersion
              "0x32D2E1CC89F3FBD139C35B5D5FE6430799AEEFD495C882C419A120B7257E3F5A", // siblingHash
            ],
            [
              true, // isDataOnRight
              "7", // subtreeHeight
              "62", // subtreeSize
              "181", // subtreeVersion
              "0x691B2504CD253868BCCD43774C8B8DBFA1E2D0D41C07C23F2F1237FCF0D2F0D8", // siblingHash
            ],
          ],
        ),
        "NO_ORACLE_ROOT_STATE_DATA",
      );
    });

    it("should accept correct data verification", async () => {
      const ret = await this.bridge.verifyOracleData(
        "182", // _blockHeight
        ["beeb", 1, "0x0000000342544300000000000003e8", 4, 4], // _requestPacket
        ["beeb", 1, 4, 1591598291, 1591598295, 1, "0x0000000000948e69"], // _responsePacket
        "163", // _version
        [
          [
            true, // isDataOnRight
            "2", // subtreeHeight
            "3", // subtreeSize
            "180", // subtreeVersion
            "0x4D4479F8CF02CBA65F95231B06EEAA51E99F75A153C3ED28D9A86B565DE59306", // siblingHash
          ],
          [
            true, // isDataOnRight
            "3", // subtreeHeight
            "5", // subtreeSize
            "180", // subtreeVersion
            "0x8861AD25F99A677D4934541A99928CDBE18BBF34EE39D754E93CCE090BE70502", // siblingHash
          ],
          [
            true, // isDataOnRight
            "4", // subtreeHeight
            "9", // subtreeSize
            "180", // subtreeVersion
            "0x5D162C955AE030390CEA63CA7ED8BA72B7A49E0BC73DAEA23CF6B79E8899C49C", // siblingHash
          ],
          [
            true, // isDataOnRight
            "5", // subtreeHeight
            "16", // subtreeSize
            "180", // subtreeVersion
            "0x08DD24B96C3C9413BA46A7149232C18AD66DB68AC04CF2A770B707B6D29FC8F7", // siblingHash
          ],
          [
            true, // isDataOnRight
            "6", // subtreeHeight
            "24", // subtreeSize
            "180", // subtreeVersion
            "0x32D2E1CC89F3FBD139C35B5D5FE6430799AEEFD495C882C419A120B7257E3F5A", // siblingHash
          ],
          [
            true, // isDataOnRight
            "7", // subtreeHeight
            "62", // subtreeSize
            "181", // subtreeVersion
            "0x691B2504CD253868BCCD43774C8B8DBFA1E2D0D41C07C23F2F1237FCF0D2F0D8", // siblingHash
          ],
        ],
      );
      ret[0]
        .toString()
        .should.eq(
          ["beeb", 1, "0x0000000342544300000000000003e8", 4, 4].toString(),
        );
      ret[1]
        .toString()
        .should.eq(
          [
            "beeb",
            1,
            4,
            1591598291,
            1591598295,
            1,
            "0x0000000000948e69",
          ].toString(),
        );
    });

    it("should not accept invalid data verification", async () => {
      await expectRevert(
        this.bridge.verifyOracleData(
          "182", // _blockHeight
          ["wrong_id", 1, "0x0000000342544300000000000003e8", 4, 4], // _requestPacket
          ["wrong_id", 1, 4, 1591598291, 1591598295, 1, "0x0000000000948e69"], // _responsePacket
          "163", // _version
          [
            [
              true, // isDataOnRight
              "2", // subtreeHeight
              "3", // subtreeSize
              "180", // subtreeVersion
              "0x4D4479F8CF02CBA65F95231B06EEAA51E99F75A153C3ED28D9A86B565DE59306", // siblingHash
            ],
            [
              true, // isDataOnRight
              "3", // subtreeHeight
              "5", // subtreeSize
              "180", // subtreeVersion
              "0x8861AD25F99A677D4934541A99928CDBE18BBF34EE39D754E93CCE090BE70502", // siblingHash
            ],
            [
              true, // isDataOnRight
              "4", // subtreeHeight
              "9", // subtreeSize
              "180", // subtreeVersion
              "0x5D162C955AE030390CEA63CA7ED8BA72B7A49E0BC73DAEA23CF6B79E8899C49C", // siblingHash
            ],
            [
              true, // isDataOnRight
              "5", // subtreeHeight
              "16", // subtreeSize
              "180", // subtreeVersion
              "0x08DD24B96C3C9413BA46A7149232C18AD66DB68AC04CF2A770B707B6D29FC8F7", // siblingHash
            ],
            [
              true, // isDataOnRight
              "6", // subtreeHeight
              "24", // subtreeSize
              "180", // subtreeVersion
              "0x32D2E1CC89F3FBD139C35B5D5FE6430799AEEFD495C882C419A120B7257E3F5A", // siblingHash
            ],
            [
              true, // isDataOnRight
              "7", // subtreeHeight
              "62", // subtreeSize
              "181", // subtreeVersion
              "0x691B2504CD253868BCCD43774C8B8DBFA1E2D0D41C07C23F2F1237FCF0D2F0D8", // siblingHash
            ],
          ],
        ),
        "INVALID_ORACLE_DATA_PROOF",
      );
    });

    it("should not accept incomplete proof", async () => {
      await expectRevert(
        this.bridge.verifyOracleData(
          "182", // _blockHeight
          ["beeb", 1, "0x0000000342544300000000000003e8", 4, 4], // _requestPacket
          ["beeb", 1, 4, 1591598291, 1591598295, 1, "0x0000000000948e69"], // _responsePacket
          "163", // _version
          [
            [
              true, // isDataOnRight
              "2", // subtreeHeight
              "3", // subtreeSize
              "180", // subtreeVersion
              "0x4D4479F8CF02CBA65F95231B06EEAA51E99F75A153C3ED28D9A86B565DE59306", // siblingHash
            ],
            [
              true, // isDataOnRight
              "3", // subtreeHeight
              "5", // subtreeSize
              "180", // subtreeVersion
              "0x8861AD25F99A677D4934541A99928CDBE18BBF34EE39D754E93CCE090BE70502", // siblingHash
            ],
            [
              true, // isDataOnRight
              "7", // subtreeHeight
              "62", // subtreeSize
              "181", // subtreeVersion
              "0x691B2504CD253868BCCD43774C8B8DBFA1E2D0D41C07C23F2F1237FCF0D2F0D8", // siblingHash
            ],
          ],
        ),
        "INVALID_ORACLE_DATA_PROOF",
      );
    });
  });

  context("Relay and Verfiy data", () => {
    beforeEach(async () => {
      this.bridge = await Bridge.new([
        ["0x88e1cd00710495EEB93D4f522d16bC8B87Cb00FE", 100],
        ["0x652D89a66Eb4eA55366c45b1f9ACfc8e2179E1c5", 100],
        ["0xB956589b6fC5523eeD0d9eEcfF06262Ce84ff260", 100],
        ["0xaAA22E077492CbaD414098EBD98AA8dc1C7AE8D9", 100],
      ]);

      this.receiver = await ReceiverMock.new(this.bridge.address);
    });

    it("should accept valid relay and verify", async () => {
      await this.receiver.relayAndSafe(
        "0x0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000005E000000000000000000000000000000000000000000000000000000000000001BEB0CC616F4E76EBA2C1845FD2321AD881991A2990F17CD278EB5F6D17DA032FAF9459616C154A23567A7281FB577BBFA1AA8D36382C4F64362968202FD32A0B65CBADB1694A5152C2B03F4960E1229745B39D7C41B32DC54E0C207799AE471981B1F2FD852E790E735CA2D3014F96A2A53C60393E9C6BBF941B9A6DD6A05CF6F93D913423122F2237A9A046D7EBFD13C3A6F1DF93A1517A9F0B60A492DBC369D832FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869EEEA5D164B32B494765EB256279014366747DB8941C23F23B2FB09A9BBBF721762C4FD636ADF805490129912F7FC18A2766AABD9FD4807F2FF18ED4CCD23F2583004209A161040AB1778E2F2C00EE482F205B28EFBA439FCB04EA283F619478D96E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D7F4BE7E5A1EB872AD44103360DDC190410331280C42A54D829A5D752C796685D00000000000000000000000000000000000000000000000000000000000001A00000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001A000000000000000000000000000000000000000000000000000000000000002E0B0EFF36D1214C35F785D82A7947589DBA3F7D6AE35DCB92B1B3ACA1DF441E1E77BE19DD7F54C0AB0726CC5074FE65A887C2F2CD736CDAB1ADE1B7BD5C378ABE1000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211BE0100000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A201E0D38AC4548746D650A022463529C1F64777038AEFDD2D16BF358DAA6E41B8010012A0C08CE87C7F705108C9FA29B01320962616E64636861696E00FC6A4AAE096D2606050269FDE7AC02F58C23FE10DD219F8805696C8AA3B1BB656C324293F560B082923F9F1F1CC0307A78633095B87E4F4047A57AD650FD971B000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211BE0100000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A201E0D38AC4548746D650A022463529C1F64777038AEFDD2D16BF358DAA6E41B8010012A0C08CE87C7F70510F6A5FD9C01320962616E64636861696E00D039E1D13E1837731A5719626075F1EF92FF48C6FBBEC68B2EF9B3B34A6086DB278405F72CA62F7FF67C28B896CA38AB0534974D96A24ADCEFC509E052530187000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211BE0100000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A201E0D38AC4548746D650A022463529C1F64777038AEFDD2D16BF358DAA6E41B8010012A0C08CE87C7F70510D3D5DD9B01320962616E64636861696E00000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000001BE00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001C000000000000000000000000000000000000000000000000000000000000001BC000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000E00000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000047465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F000000034254430000000000000064000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000005EF1C3C2000000000000000000000000000000000000000000000000000000005EF1C3C90000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000047465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000EAAE6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000001BC1D3927941AEC0602E1FCAB94B4D3E57DA16A2455165CB097ADFDFDF34A3E168800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000001BC17480C9A0FACA2C2ECEF5FDC7627B11F898F5652F3022E8D0B2DA40356D6D8E400000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000001BCD90FCF3847CCD9EC012100F251F6E258D1E6B4E5E03A94FB06927DBB11F3862300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000D00000000000000000000000000000000000000000000000000000000000001BC5332E6182A047D2B63DF9C4A5EDBB34D0760A5EEA2816BFCC50EF0A316267A4900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000001BCFDD7908F23BA8FBE99C7F91C660A94A96231E807566E89FE524E739B1F6252C400000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000007000000000000000000000000000000000000000000000000000000000000003800000000000000000000000000000000000000000000000000000000000001BDEFDF574E7D863CF4D8B8B08ED1558A6E6F47D5091667F29B7B2D37DC44D5F156",
      );
      (await this.bridge.oracleStates(446))
        .toString()
        .should.eq(
          "0xcbadb1694a5152c2b03f4960e1229745b39d7c41b32dc54e0c207799ae471981",
        );
      const req = await this.receiver.latestReq();
      req[0].toString().should.eq("test");
      req[1].toString().should.eq("1");
      req[2].toString().should.eq("0x000000034254430000000000000064");
      req[3].toString().should.eq("4");
      req[4].toString().should.eq("4");
      const res = await this.receiver.latestRes();
      res[0].toString().should.eq("test");
      res[1].toString().should.eq("1");
      res[2].toString().should.eq("4");
      res[3].toString().should.eq("1592902594");
      res[4].toString().should.eq("1592902601");
      res[5].toString().should.eq("1");
      res[6].toString().should.eq("0x00000000000eaae6");
    });

    it("should accept valid relay and verify case 2", async () => {
      await this.receiver.relayAndSafe(
        "0x0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000005E00000000000000000000000000000000000000000000000000000000000000584811032F41A5918CFC860EBCEA1B7678564C622B4E3F04E28C9D8B195F04661E11E06EA167A89DE60ABF52C60350793C3823A0A4B9681F59DAEB8F20942B8BCF3FF2B888760FFA9EFA09E35763D8A5BA3EC794D00BCD1F9A901FA007F1F16E2EBB1F2FD852E790E735CA2D3014F96A2A53C60393E9C6BBF941B9A6DD6A05CF6F9C6507DE937080730702A2C39AD8AA4666FD24E12A9496E4546A0BD4031E6D4EE32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E2A448C96300F1CB90567D815C6B2F6EC0BBA29615FD88DEAB57299C76F0B30FA3EBF2264C2C941DF347EB97F55B4ADCD4784F4F0A8E66D9F2E3FDA413115E085004209A161040AB1778E2F2C00EE482F205B28EFBA439FCB04EA283F619478D96E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D0EFE3E12F46363C7779140D4CE659925DB52F19053E114D7CC4EFD666B37F79F00000000000000000000000000000000000000000000000000000000000001A00000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001A000000000000000000000000000000000000000000000000000000000000002E0628716AC49023DE84ADDDDDCBEF8007C2E41E5B58306CE87A0AFAD5447BC62102F520DB2BFF3003D5612E03B7AAA99472164C73922A977AF95E1FFC2A67C53B4000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510CBE1CFBE02320962616E64636861696E00FF2BA7E2BD2175827997C706451B5DA768B6873D7BA4129FC6EE54E62BA9C5933C7F7E5B08D1733D430658431545C9A2F57E4641B3B4CD52E567F27BE9485E60000000000000000000000000000000000000000000000000000000000000001C00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510A3F0E5BE02320962616E64636861696E005A2F66B4D62D905B98277CD2807A324F0651340E80AE0249E500BEB5DDCDCE113C1ED3D960B19E0CA7D321215874C6E91407AE3D2748F2E3B617FAD833C30B6D000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510A394A6BF02320962616E64636861696E0000000000000000000000000000000000000000000000000000000000000006C0000000000000000000000000000000000000000000000000000000000000058400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001A0000000000000000000000000000000000000000000000000000000000000058100000000000000000000000000000000000000000000000000000000000002E000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000C0000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F0000000342544300000000000003E8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000005EF1C903000000000000000000000000000000000000000000000000000000005EF1C907000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000009269B3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000005818D09A67A6AEBB1498F3D104AE86C23D0C8E2E86DCB0A96F1088ACA50B6D5E403000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000058121C6CCA538BE5E9673479BA5694886335CDBBD0FCCCD8D62376728C1133F0027000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000058157C9A0C6D2089B3911DC3BFD173CCD88922ED48030686BA3B3F8E4325B5F3CAC00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C000000000000000000000000000000000000000000000000000000000000058114DC21A48E352EC5D08B52473DA16CC6CA515E9E94124EA68B84A011B5DA400C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001700000000000000000000000000000000000000000000000000000000000005810FCACF91A581CF180802122ABB9D02A67590FE38C7AEA5BAAA53416E91BF30E20000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000430000000000000000000000000000000000000000000000000000000000000583C0062B4FF613ECBCF16E37A4423961AFEBF0302A208702D67E583622AD4A3DDA",
      );
      (await this.bridge.oracleStates(1412))
        .toString()
        .should.eq(
          "0xff2b888760ffa9efa09e35763d8a5ba3ec794d00bcd1f9a901fa007f1f16e2eb",
        );
      const req = await this.receiver.latestReq();
      req[0].toString().should.eq("");
      req[1].toString().should.eq("1");
      req[2].toString().should.eq("0x0000000342544300000000000003e8");
      req[3].toString().should.eq("4");
      req[4].toString().should.eq("4");
      const res = await this.receiver.latestRes();
      res[0].toString().should.eq("");
      res[1].toString().should.eq("2");
      res[2].toString().should.eq("4");
      res[3].toString().should.eq("1592903939");
      res[4].toString().should.eq("1592903943");
      res[5].toString().should.eq("1");
      res[6].toString().should.eq("0x00000000009269b3");
    });

    it("should revert invalid relay and verify", async () => {
      await expectRevert(
        this.receiver.relayAndSafe(
          "0x0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000005E00000000000000000000000000000000000000000000000000000000000000584811032F41A5918CFC860EBCEA1B7678564C622B4E3F04E28C9D8B195F04661E11E06EA167A89DE60ABF52C60350793C3823A0A4B9681F59DAEB8F20942B8BCF3FF2B888760FFA9EFA09E35763D8A5BA3EC794D00BCD1F9A901FA007F1F16E2EBB1F2FD852E790E735CA2D3014F96A2A53C60393E9C6BBF941B9A6DD6A05CF6F9C6507DE937080730702A2C39AD8AA4666FD24E12A9496E4546A0BD4031E6D4EE32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E2A448C96300F1CB90567D815C6B2F6EC0BBA29615FD88DEAB57299C76F0B30FA3EBF2264C2C941DF347EB97F55B4ADCD4784F4F0A8E66D9F2E3FDA413115E085004209A161040AB1778E2F2C00EE482F205B28EFBA439FCB04EA283F619478D96E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D0EFE3E12F46363C7779140D4CE659925DB52F19053E114D7CC4EFD666B37F79F00000000000000000000000000000000000000000000000000000000000001A00000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001A000000000000000000000000000000000000000000000000000000000000002E0628716AC49023DE84ADDDDDCBEF8007C2E41E5B58306CE87A0AFAD5447BC62102F520DB2BFF3003D5612E03B7AAA99472164C73922A977AF95E1FFC2A67C53B4000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510CBE1CFBE02320962616E64636861696E00FF2BA7E2BD2175827997C706451B5DA768B6873D7BA4129FC6EE54E62BA9C5933C7F7E5B08D1733D430658431545C9A2F57E4641B3B4CD52E567F27BE9485E60000000000000000000000000000000000000000000000000000000000000001C00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510A3F0E5BE02320962616E64636861696E005A2F66B4D62D905B98277CD2807A324F0651340E80AE0249E500BEB5DDCDCE123C1ED3D960B19E0CA7D321215874C6E91407AE3D2748F2E3B617FAD833C30B6D000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510A394A6BF02320962616E64636861696E0000000000000000000000000000000000000000000000000000000000000006C0000000000000000000000000000000000000000000000000000000000000058400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001A0000000000000000000000000000000000000000000000000000000000000058100000000000000000000000000000000000000000000000000000000000002E000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000C0000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F0000000342544300000000000003E8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000005EF1C903000000000000000000000000000000000000000000000000000000005EF1C907000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000009269B3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000005818D09A67A6AEBB1498F3D104AE86C23D0C8E2E86DCB0A96F1088ACA50B6D5E403000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000058121C6CCA538BE5E9673479BA5694886335CDBBD0FCCCD8D62376728C1133F0027000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000058157C9A0C6D2089B3911DC3BFD173CCD88922ED48030686BA3B3F8E4325B5F3CAC00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C000000000000000000000000000000000000000000000000000000000000058114DC21A48E352EC5D08B52473DA16CC6CA515E9E94124EA68B84A011B5DA400C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001700000000000000000000000000000000000000000000000000000000000005810FCACF91A581CF180802122ABB9D02A67590FE38C7AEA5BAAA53416E91BF30E20000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000430000000000000000000000000000000000000000000000000000000000000583C0062B4FF613ECBCF16E37A4423961AFEBF0302A208702D67E583622AD4A3DDA",
        ),
        "RELAY_ORACLE_STATE_FAILED.",
      );

      await expectRevert(
        this.receiver.relayAndSafe(
          "0x0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000005E00000000000000000000000000000000000000000000000000000000000000584811032F41A5918CFC860EBCEA1B7678564C622B4E3F04E28C9D8B195F04661E11E06EA167A89DE60ABF52C60350793C3823A0A4B9681F59DAEB8F20942B8BCF3FF2B888760FFA9EFA09E35763D8A5BA3EC794D00BCD1F9A901FA007F1F16E2EBB1F2FD852E790E735CA2D3014F96A2A53C60393E9C6BBF941B9A6DD6A05CF6F9C6507DE937080730702A2C39AD8AA4666FD24E12A9496E4546A0BD4031E6D4EE32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E2A448C96300F1CB90567D815C6B2F6EC0BBA29615FD88DEAB57299C76F0B30FA3EBF2264C2C941DF347EB97F55B4ADCD4784F4F0A8E66D9F2E3FDA413115E085004209A161040AB1778E2F2C00EE482F205B28EFBA439FCB04EA283F619478D96E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D0EFE3E12F46363C7779140D4CE659925DB52F19053E114D7CC4EFD666B37F79F00000000000000000000000000000000000000000000000000000000000001A00000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001A000000000000000000000000000000000000000000000000000000000000002E0628716AC49023DE84ADDDDDCBEF8007C2E41E5B58306CE87A0AFAD5447BC62102F520DB2BFF3003D5612E03B7AAA99472164C73922A977AF95E1FFC2A67C53B4000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510CBE1CFBE02320962616E64636861696E00FF2BA7E2BD2175827997C706451B5DA768B6873D7BA4129FC6EE54E62BA9C5933C7F7E5B08D1733D430658431545C9A2F57E4641B3B4CD52E567F27BE9485E60000000000000000000000000000000000000000000000000000000000000001C00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510A3F0E5BE02320962616E64636861696E005A2F66B4D62D905B98277CD2807A324F0651340E80AE0249E500BEB5DDCDCE113C1ED3D960B19E0CA7D321215874C6E91407AE3D2748F2E3B617FAD833C30B6D000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211840500000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20B8AAC9C5F107C71EACDA8CCDDD2506F30ECFA75685E12E403DDCC6411F6822FF10012A0C088D92C7F70510A394A6BF02320962616E64636861696E0000000000000000000000000000000000000000000000000000000000000006C0000000000000000000000000000000000000000000000000000000000000058400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001A0000000000000000000000000000000000000000000000000000000000000058100000000000000000000000000000000000000000000000000000000000002E000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000C0000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F0000000342544300000000000003E8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000005EF1C903000000000000000000000000000000000000000000000000000000005EF1C907000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000009269B3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000005818D09A67A6AEBB1498F3D104AE86C23D0C8E2E86DCB0A96F1088ACA50B6D5E403000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000058121C6CCA538BE5E9673479BA5694886335CDBBD0FCCCD8D62376728C1133F0027000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000058157C9A0C6D2089B3911DC3BFD173CCD88922ED48030686BA3B3F8E4325B5F3CAC00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C000000000000000000000000000000000000000000000000000000000000058114DC21A48E352EC5D08B52473DA16CC6CA515E9E94124EA68B84A011B5DA400C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001700000000000000000000000000000000000000000000000000000000000005810FCACF91A581CF180802122ABB9D02A67590FE38C7AEA5BAAA53416E91BF30E20000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000430000000000000000000000000000000000000000000000000000000000000583C0062B4FF613ECBCF16E37A4423961AFEBF0302A208702D67E583622AD4A3DDE",
        ),
        "VERIFY_ORACLE_DATA_FAILED.",
      );
    });
  });

  context("Update provider powers", () => {
    beforeEach(async () => {
      this.bridge = await Bridge.new(
        [
          ["0x652D89a66Eb4eA55366c45b1f9ACfc8e2179E1c5", 100],
          ["0x88e1cd00710495EEB93D4f522d16bC8B87Cb00FE", 100],
          ["0xaAA22E077492CbaD414098EBD98AA8dc1C7AE8D9", 100],
          ["0xB956589b6fC5523eeD0d9eEcfF06262Ce84ff260", 100],
        ],
        { from: owner },
      );
    });

    it("should revert if update validator power by non-onwer", async () => {
      await expectRevert(
        this.bridge.updateValidatorPowers(
          [["0x652D89a66Eb4eA55366c45b1f9ACfc8e2179E1c5", 150]],
          {
            from: alice,
          },
        ),
        "Ownable: caller is not the owner.",
      );
    });

    it("should update a validator power", async () => {
      await this.bridge.updateValidatorPowers(
        [["0x652D89a66Eb4eA55366c45b1f9ACfc8e2179E1c5", 150]],
        { from: owner },
      );

      (
        await this.bridge.validatorPowers(
          "0x652D89a66Eb4eA55366c45b1f9ACfc8e2179E1c5",
        )
      )
        .toString()
        .should.eq("150");

      (await this.bridge.totalValidatorPower()).toString().should.eq("450");
    });

    it("should update validator powers", async () => {
      await this.bridge.updateValidatorPowers(
        [
          ["0x652D89a66Eb4eA55366c45b1f9ACfc8e2179E1c5", 150],
          ["0x88e1cd00710495EEB93D4f522d16bC8B87Cb00FE", 0],
          ["0x85109F11A7E1385ee826FbF5dA97bB97dba0D76f", 200],
        ],
        { from: owner },
      );

      (
        await this.bridge.validatorPowers(
          "0x652D89a66Eb4eA55366c45b1f9ACfc8e2179E1c5",
        )
      )
        .toString()
        .should.eq("150");

      (
        await this.bridge.validatorPowers(
          "0x88e1cd00710495EEB93D4f522d16bC8B87Cb00FE",
        )
      )
        .toString()
        .should.eq("0");

      (
        await this.bridge.validatorPowers(
          "0x85109F11A7E1385ee826FbF5dA97bB97dba0D76f",
        )
      )
        .toString()
        .should.eq("200");

      (await this.bridge.totalValidatorPower()).toString().should.eq("550");
    });
  });

  context("Relay and Multiple Verfiy data", () => {
    beforeEach(async () => {
      this.bridge = await Bridge.new([
        ["0xaAA22E077492CbaD414098EBD98AA8dc1C7AE8D9", 100],
      ]);

      this.receiver = await ReceiverMock.new(this.bridge.address);
    });

    it("should accept valid relay and multiple verify", async () => {
      await this.receiver.relayAndMultiSafe(
        "0x00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000002E445CD72E61F5D79ECC26F8CA024FB86D3A6A925071DDF73CB79D1BBAEA3C5132C47359DC797788AA7A77A27B8B40BF23F5EF60594E34253373DDFB76251240C43866A2417EB63733CC9B7A5CB89EDC98F308EE066FFE6E59E0C6CBE22B700704E2B6A7E0F44ED9C179A47A40F93D5824189A5426D6C3F77692DE28E50E20A33DDAF86E0275A883BDCA2276CC1FE523F4E43C50C5612EB996623D287F80B84CFDA32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E48DFB8B1F245FAB852685BEEAB33EBB09CD93EA77BDDD9B73AEB833FC2FC028B1EF4C4CD033DCB00C0B471C30B35ABC13C2A8B682D70CCA2CC74DFBBEE46CDFAA54CCB0556B3BD0C34805C986FED66F1BDF3FC989BA01F2F34470EE3A7DA71016E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D0CF1E6ECE60E49D19BB57C1A432E805F39BB4F65C366741E4F03FA54FBD9071400000000000000000000000000000000000000000000000000000000000001A0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000203D2DD609088F4A660225913296A5D392051FCCC6CCBA9C74E46DE2A5E6CBF3D7733483953F4283ADF7DEE7D082601B641B14A85B71D4FE7D6584BF2FED620904000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211E40200000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A2060F3ED6948B113B8B528C6F79D33F5A40544AD5330132A2ABFD47A18A147D84910012A0C0890D2D9FA0510C8BD9DD901320962616E64636861696E000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000007A00000000000000000000000000000000000000000000000000000000000000EE0000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000001CE000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002200000002464200000010324B4D43424C415A4D3554453256504700000000000003E800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F566759000000000000000000000000000000000000000000000000000000005F56675C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000004506A000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A2C1302062844B84E96DB63A6924AA593F66A9E8A535CF657DE4D1F86CFEF8058B00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A2301E07C9ED7015E98CBC234AEB87003C05AF21F4273EEE8C3F55BF668AECB4D000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002A2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E00000000000000000000000000000000000000000000000000000000000000247000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002400000004474F4F4700000010324B4D43424C415A4D3554453256504700000000000003E80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F566816000000000000000000000000000000000000000000000000000000005F56681900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000184700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A21646BAB59AD79C62A66123C7CBF0B1CE8830336C5F3CB5CC689CC45C5BAA140C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A28C3D3FC25F23B7F63ED18C8900FC40582E7ED488B71C7FE19126DCCCDCE08D7600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002A2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000002A2000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024000000044141504C00000010324B4D43424C415A4D3554453256504700000000000003E80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F5668A4000000000000000000000000000000000000000000000000000000005F5668A700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000001D880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A2420CE1DDED95E4D5240EEB397AAC8C82C372028466EBC5DC3919A0D22C75EDE800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A28C3D3FC25F23B7F63ED18C8900FC40582E7ED488B71C7FE19126DCCCDCE08D7600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002A2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79",
      );
      (await this.bridge.oracleStates(740))
        .toString()
        .should.eq(
          "0x866a2417eb63733cc9b7a5cb89edc98f308ee066ffe6e59e0c6cbe22b700704e",
        );

      let expects = [
        [
          `["from_scan","2","0x00000002464200000010324b4d43424c415a4d3554453256504700000000000003e8","1","1"]`,
          `["from_scan","1","1",1599498073,1599498076,"1","0x000000000004506a"]`,
        ],
        [
          `["from_scan","2","0x00000004474f4f4700000010324b4d43424c415a4d3554453256504700000000000003e8","1","1"]`,
          `["from_scan","2","1",1599498262,1599498265,"1","0x0000000000184700"]`,
        ],
        [
          `["from_scan","2","0x000000044141504c00000010324b4d43424c415a4d3554453256504700000000000003e8","1","1"]`,
          `["from_scan","3","1",1599498404,1599498407,"1","0x000000000001d880"]`,
        ],
      ];

      for (let i = 0; i < expects.length; i++) {
        const req = await this.receiver.latestRequests(i);
        const res = await this.receiver.latestResponses(i);
        JSON.stringify([
          req["clientId"],
          req["oracleScriptId"],
          req["params"],
          req["askCount"],
          req["minCount"],
        ]).should.eq(expects[i][0]);
        JSON.stringify([
          res["clientId"],
          res["requestId"],
          res["ansCount"],
          Number(res["requestTime"]),
          Number(res["resolveTime"]),
          res["resolveStatus"],
          res["result"],
        ]).should.eq(expects[i][1]);
      }
    });

    it("should accept valid relay and multiple verify case 2", async () => {
      await this.receiver.relayAndMultiSafe(
        "0x00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000C8C641B5C4D261848343C361D0A7124BAEDB0F87D8FF9B7084B84C027A37661704CB17D5D0B9A508411553993B1995709B8A32779DD63225F10BBF24386FDB1DA97A0B5851CA5904765DFA70A8E6869CEDA3B0AD9BFA57131915F962E5288CBBA62B6A7E0F44ED9C179A47A40F93D5824189A5426D6C3F77692DE28E50E20A33DDEB9A3C49E94024204ACC1CE6BA1E3EDBC9E762BF74E8B897B7573F414106EEEA32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E9948D86E69F6A7A5492CA448F8B2DC9B740DAB7C3CFC9AAECBE65ED12AD843566B5654FF637E9CAFE7B2B7EA44A32779B15570EFFC36DB6172176FAA0305D6D9A54CCB0556B3BD0C34805C986FED66F1BDF3FC989BA01F2F34470EE3A7DA71016E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D0CF1E6ECE60E49D19BB57C1A432E805F39BB4F65C366741E4F03FA54FBD9071400000000000000000000000000000000000000000000000000000000000001A000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020F66CC500EDC342D8CB2EF6765AC32499DBAF46ECE60CF55F8F0A65C06B38CBA01B49CBD26734FE8D9069B88B923941C154173D1671C9B44389459267709577CC000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211C80000000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A20194CC26CCD6EDFA7AFFFE9F5D94493885AA4FA42A28EDD3D2F19A8AA38CE1EAD10012A0C08DAFAD9FA051080ECC5D103320962616E64636861696E000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000007A00000000000000000000000000000000000000000000000000000000000000EE0000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000000C800000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000000B5000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002400000004474F4F4700000010324B4D43424C415A4D3554453256504700000000000003E80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F567D38000000000000000000000000000000000000000000000000000000005F567D3B00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000184700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000B981F005EFD6199FF9A74FC671BFEB375919665555BDE2C8BBD634BC6B2898431E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000B99C6BECB03B7A81823E4FE88F1C3DBEC26AFFB9CDFFF3BBBC8D7B6F2D2FE4C3EA00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000B9376A9AA3F3794DF32BF3D2CADC82492E17A7086ACFFE2F1A8F1A901EB7F8F13100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000000B961E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000B95D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000000C70072500D68E98E434B3DEFA2A732F8E40BE0BB09FCD3B20D9A73E4C97BB34B60000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000000C800000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000000B7000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024000000044141504C00000010324B4D43424C415A4D3554453256504700000000000003E80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F567D3B000000000000000000000000000000000000000000000000000000005F567D3E00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000001D880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000B9F22FE3D34E0B9DFA2768D9CDE347047A1E37AD9D560D65CD90C401DCF16EBF5900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000B99FA93C4D6D64DB844A1FC42B6D3D2A0BBE2EAF0BAC704166BDBCC864D47BCAC300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000B9376A9AA3F3794DF32BF3D2CADC82492E17A7086ACFFE2F1A8F1A901EB7F8F13100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000000B961E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000B95D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000000C70072500D68E98E434B3DEFA2A732F8E40BE0BB09FCD3B20D9A73E4C97BB34B60000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000000C800000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000000B9000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002200000002464200000010324B4D43424C415A4D3554453256504700000000000003E800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F567D40000000000000000000000000000000000000000000000000000000005F567D4100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000004506A000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000B928A7C6D808C59C2B866DBDE9234BE1F4DE7A6361F43B1E264EC95483746EF92E00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000B99FA93C4D6D64DB844A1FC42B6D3D2A0BBE2EAF0BAC704166BDBCC864D47BCAC300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000B9376A9AA3F3794DF32BF3D2CADC82492E17A7086ACFFE2F1A8F1A901EB7F8F13100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000000B961E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000B95D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000000C70072500D68E98E434B3DEFA2A732F8E40BE0BB09FCD3B20D9A73E4C97BB34B60",
      );
      (await this.bridge.oracleStates(200))
        .toString()
        .should.eq(
          "0x7a0b5851ca5904765dfa70a8e6869ceda3b0ad9bfa57131915f962e5288cbba6",
        );

      let expects = [
        [
          `["from_scan","2","0x00000004474f4f4700000010324b4d43424c415a4d3554453256504700000000000003e8","1","1"]`,
          `["from_scan","1","1",1599503672,1599503675,"1","0x0000000000184700"]`,
        ],
        [
          `["from_scan","2","0x000000044141504c00000010324b4d43424c415a4d3554453256504700000000000003e8","1","1"]`,
          `["from_scan","2","1",1599503675,1599503678,"1","0x000000000001d880"]`,
        ],
        [
          `["from_scan","2","0x00000002464200000010324b4d43424c415a4d3554453256504700000000000003e8","1","1"]`,
          `["from_scan","3","1",1599503680,1599503681,"1","0x000000000004506a"]`,
        ],
      ];

      for (let i = 0; i < expects.length; i++) {
        const req = await this.receiver.latestRequests(i);
        const res = await this.receiver.latestResponses(i);
        JSON.stringify([
          req["clientId"],
          req["oracleScriptId"],
          req["params"],
          req["askCount"],
          req["minCount"],
        ]).should.eq(expects[i][0]);
        JSON.stringify([
          res["clientId"],
          res["requestId"],
          res["ansCount"],
          Number(res["requestTime"]),
          Number(res["resolveTime"]),
          res["resolveStatus"],
          res["result"],
        ]).should.eq(expects[i][1]);
      }
    });

    it("should revert invalid relay and verify", async () => {
      await expectRevert(
        this.receiver.relayAndMultiSafe(
          "0x00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000003E445CD72E61F5D79ECC26F8CA024FB86D3A6A925071DDF73CB79D1BBAEA3C5132C47359DC797788AA7A77A27B8B40BF23F5EF60594E34253373DDFB76251240C43866A2417EB63733CC9B7A5CB89EDC98F308EE066FFE6E59E0C6CBE22B700704E2B6A7E0F44ED9C179A47A40F93D5824189A5426D6C3F77692DE28E50E20A33DDAF86E0275A883BDCA2276CC1FE523F4E43C50C5612EB996623D287F80B84CFDA32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E48DFB8B1F245FAB852685BEEAB33EBB09CD93EA77BDDD9B73AEB833FC2FC028B1EF4C4CD033DCB00C0B471C30B35ABC13C2A8B682D70CCA2CC74DFBBEE46CDFAA54CCB0556B3BD0C34805C986FED66F1BDF3FC989BA01F2F34470EE3A7DA71016E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D0CF1E6ECE60E49D19BB57C1A432E805F39BB4F65C366741E4F03FA54FBD9071400000000000000000000000000000000000000000000000000000000000001A0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000203D2DD609088F4A660225913296A5D392051FCCC6CCBA9C74E46DE2A5E6CBF3D7733483953F4283ADF7DEE7D082601B641B14A85B71D4FE7D6584BF2FED620904000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211E40200000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A2060F3ED6948B113B8B528C6F79D33F5A40544AD5330132A2ABFD47A18A147D84910012A0C0890D2D9FA0510C8BD9DD901320962616E64636861696E000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000007A00000000000000000000000000000000000000000000000000000000000000EE0000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000001CE000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002200000002464200000010324B4D43424C415A4D3554453256504700000000000003E800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F566759000000000000000000000000000000000000000000000000000000005F56675C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000004506A000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A2C1302062844B84E96DB63A6924AA593F66A9E8A535CF657DE4D1F86CFEF8058B00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A2301E07C9ED7015E98CBC234AEB87003C05AF21F4273EEE8C3F55BF668AECB4D000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002A2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E00000000000000000000000000000000000000000000000000000000000000247000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002400000004474F4F4700000010324B4D43424C415A4D3554453256504700000000000003E80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F566816000000000000000000000000000000000000000000000000000000005F56681900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000184700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A21646BAB59AD79C62A66123C7CBF0B1CE8830336C5F3CB5CC689CC45C5BAA140C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A28C3D3FC25F23B7F63ED18C8900FC40582E7ED488B71C7FE19126DCCCDCE08D7600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002A2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000002A2000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024000000044141504C00000010324B4D43424C415A4D3554453256504700000000000003E80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F5668A4000000000000000000000000000000000000000000000000000000005F5668A700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000001D880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A2420CE1DDED95E4D5240EEB397AAC8C82C372028466EBC5DC3919A0D22C75EDE800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A28C3D3FC25F23B7F63ED18C8900FC40582E7ED488B71C7FE19126DCCCDCE08D7600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002A2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79",
        ),
        "RELAY_ORACLE_STATE_FAILED.",
      );

      await expectRevert(
        this.receiver.relayAndMultiSafe(
          "0x00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000002E445CD72E61F5D79ECC26F8CA024FB86D3A6A925071DDF73CB79D1BBAEA3C5132C47359DC797788AA7A77A27B8B40BF23F5EF60594E34253373DDFB76251240C43866A2417EB63733CC9B7A5CB89EDC98F308EE066FFE6E59E0C6CBE22B700704E2B6A7E0F44ED9C179A47A40F93D5824189A5426D6C3F77692DE28E50E20A33DDAF86E0275A883BDCA2276CC1FE523F4E43C50C5612EB996623D287F80B84CFDA32FA694879095840619F5E49380612BD296FF7E950EAFB66FF654D99CA70869E48DFB8B1F245FAB852685BEEAB33EBB09CD93EA77BDDD9B73AEB833FC2FC028B1EF4C4CD033DCB00C0B471C30B35ABC13C2A8B682D70CCA2CC74DFBBEE46CDFAA54CCB0556B3BD0C34805C986FED66F1BDF3FC989BA01F2F34470EE3A7DA71016E340B9CFFB37A989CA544E6BB780A2C78901D3FB33738768511A30617AFA01D0CF1E6ECE60E49D19BB57C1A432E805F39BB4F65C366741E4F03FA54FBD9071400000000000000000000000000000000000000000000000000000000000001A0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000203D2DD609088F4A660225913296A5D392051FCCC6CCBA9C74E46DE2A5E6CBF3D7733483953F4283ADF7DEE7D082601B641B14A85B71D4FE7D6584BF2FED620904000000000000000000000000000000000000000000000000000000000000001B00000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000106E080211E40200000000000022480A2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003F12240A2060F3ED6948B113B8B528C6F79D33F5A40544AD5330132A2ABFD47A18A147D84910012A0C0890D2D9FA0510C8BD9DD901320962616E64636861696E000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000007A00000000000000000000000000000000000000000000000000000000000000EE0000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000001CE000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002200000002464200000010324B4D43424C415A4D3554453256504700000000000003E800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F566759000000000000000000000000000000000000000000000000000000005F56675C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000004506A000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A2C1302062844B84E96DB63A6924AA593F66A9E8A535CF657DE4D1F86CFEF8058B00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A2301E07C9ED7015E98CBC234AEB87003C05AF21F4273EEE8C3F55BF668AECB4D000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002B2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E00000000000000000000000000000000000000000000000000000000000000247000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002400000004474F4F4700000010324B4D43424C415A4D3554453256504700000000000003E80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F566816000000000000000000000000000000000000000000000000000000005F56681900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000184700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A21646BAB59AD79C62A66123C7CBF0B1CE8830336C5F3CB5CC689CC45C5BAA140C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A28C3D3FC25F23B7F63ED18C8900FC40582E7ED488B71C7FE19126DCCCDCE08D7600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002A2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000002E400000000000000000000000000000000000000000000000000000000000000A000000000000000000000000000000000000000000000000000000000000001E000000000000000000000000000000000000000000000000000000000000002A2000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000000A0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024000000044141504C00000010324B4D43424C415A4D3554453256504700000000000003E80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000005F5668A4000000000000000000000000000000000000000000000000000000005F5668A700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000966726F6D5F7363616E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000001D880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002A2420CE1DDED95E4D5240EEB397AAC8C82C372028466EBC5DC3919A0D22C75EDE800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000002A28C3D3FC25F23B7F63ED18C8900FC40582E7ED488B71C7FE19126DCCCDCE08D7600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000002A2B6936B0BB87A5579BD57C790C2A191ECF70C707F2C7493356AFD32489C48B07C00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000C00000000000000000000000000000000000000000000000000000000000002A261E55C6C45B1A9E9B86C32BB19BF819A7CB684AABD7FA4BC8C87792DAE52D38F00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000002A25D52D5033592D37ECCA65B227BF3AF502967E0833BB867DBBE6AA0848285BFEB00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002A00000000000000000000000000000000000000000000000000000000000002E33DE917D101D39159FB448360B702BC1C8778975B81CEBC8BE73C7F8DA3DE3A79",
        ),
        "VERIFY_ORACLE_DATA_FAILED.",
      );
    });
  });
});
